#!/bin/bash

i3_config_file="$HOME/.config/i3/config"
i3_config_template_file="$HOME/.config/i3/config.template"
i3_colors_config_file="$HOME/.config/i3/colors"

monitor1_runtime_file="$HOME/bin/runtime/monitor1"
monitor2_runtime_file="$HOME/bin/runtime/monitor2"

if ! [ -z "$1" ] && [ "$1"="--scratch" ]; then
  rm -r "$monitor1_runtime_file"
  rm -r "$monitor2_runtime_file"
fi

if [ ! -f "$monitor1_runtime_file" ] || [ ! -f "$monitor2_runtime_file" ]; then
  echo "Monitor runtime files are missing. Fill the information."
  c-choose-screens
fi


monitor1=`cat "$monitor1_runtime_file"`
monitor2=`cat "$monitor2_runtime_file"`

rm -f "$i3_config_file"

sed -e 's/{{monitor1}}/'"$monitor1"'/g' "$i3_config_template_file" | sed -e 's/{{monitor2}}/'"$monitor2"'/g' > "$i3_config_file"

i3_color_config='';

if [ -f "$i3_colors_config_file" ]; then
  i3_color_config=`cat "$i3_colors_config_file"`
fi

perl -0777 -pi -e 's/\{\{i3_color_config\}\}/'"$i3_color_config"'/g' "$i3_config_file" 

i3-msg restart
